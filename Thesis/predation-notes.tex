\documentclass{article}
\usepackage[english]{babel}
\usepackage{amssymb}

\begin{document}

\section{Incoming data}

$m_a (l)$ -- the member distribution with respect to size of each agent of
interest

$G_{i j} (l, w)$ -- the gape filter for predator $i$ with respect to prey $j$

$T (a)$ -- returns the taxon or type number of agent $a$

\subsection{Preliminary calculations}

$M_a$ -- the total number of members for agent $a$

$M^{\ast}_i (w)$ -- the sum of all the distributions of agents with a type $i$

$\bar{M}_i = \int_0^{\infty} M^{\ast}_i (w) d w$, which is the total number of
beasties of type $i$

\section{Calculating mortality}

Let
\[ I_{i j} (l, w) = M^{\ast}_i (l) G_{i j} (l, w) \]
and
\[ J_{i j} (l, w) = M^{\ast}_j (w) G_{i j} (l, w) . \]
$I_{i j}$ is the raw distribution of pressure of predator $i$ onto prey $j$,
and $J_{i j}$ is the raw distribution of the vulnerability of prey $j$ to the
predator $i$.

If the constants
\[ k_{i j} = \int_0^{\infty} \int_0^{\infty} I_{i j} (l, w) dl dw \]
and
\[ h_{i j} = \int_0^{\infty} \int_0^{\infty} J_{i j} (l, w) dl dw \]
are non-zero, they can be used to scale $I_{i j}$ and $J_{i j}$ so that they
form kernel functions, and we get
\[ K_{i j} (w) = \frac{1}{k_{i j}} \int_0^{\infty} I_{i j} (l, w) dl \]
which is the normalised predatory pressure with respect to size, and the
normalised vulnerability
\[ H_{i j} (w) = \frac{1}{h_{i j}} \int_0^{\infty} J_{i j} (l, w) dl . \]
Values of zero in $k_{i j}$ and $h_{i j}$ indicate that no predation is
possible -- usually because $M^{\ast}$ has collapsed. \ In this case we take
either (or both) $K_{i j} (w)$ and $H_{i j} (w)$ to be zero.

We calculate
\[ v_{i j} = \int_0^{\infty} K_{i j} (w) H_{i j} (w) dw \]
which has a value in the range $[0, 1]$. \ If $v_{i j}$ is non-zero we can
construct the normalised interaction
\[ V_{i j} (w) = \frac{1}{v_{i j}} K_{i j} (w) H_{i j} (w) \]
which indicates the proportion by size of type $j$ subjected to predation from
type $i$ at the given length $w$. \ Again a zero value for $v_{i j}$ indicates
that no interaction (``diner'' or ``dinner'') are possible.

\

The function
\[ e_{i j} (w) = M^{\ast}_j (w) V_{i j} (w)  \]
can be used to give us the the number
\[ E_{i j} = \int_0^{\infty} M^{\ast}_j (w) V_{i j} (w) d w \]
which is the exposure of prey population $j$ to an ``average'' predator in
population $i$. \ The converse,
\[ C_{i j} = \int_0^{\infty} M_i^{\ast} (w) V_{i j} (w) d w, \]
is the potential for predation of the predator type $i$ on an ``average'' prey
of type $j$.

We can then use Holling or a ratio dependent predation equation to get the
raw number of ``kills'' which we call $\Omega_{i j}$, where $\Omega_{i j} =
\bar{M}_i \mathfrak{F} (E_{i j} / A_j, p_{i j}) \Delta t$ where $\mathfrak{F}$
is the equation function, and $p_{i j}$ is the parameterisation for the
species, and $\Delta t$ is the timestep, and $A_j$ is the area/volume we
divide by to get a density. \

We can sum over a predator type
\[ \Omega_j^{\ast} = \sum_i \Omega_{i j} \]
to give us the total possible consumption of prey type $j$. \

Alternatively, we can calculate a consumption-by-size distribution and define
the function $\omega_{i j} (w)$, the raw number of kills for a length $w$ on a
consumption-by-size basis, by
\[ \omega_{i j} (w) = \bar{M}_i \mathfrak{F} (e_{i j} (w) / A_j, p_{i j})
   \Delta t. \]
Thus the impact on the prey population (at least those of length $w$) is
\[ \omega_j^{\ast} (w) = \sum_i \omega_{i j} (w) \]
and for the whole population it is
\[ \int_0^{\infty} \omega^{\ast}_j (w) d w \]
(or something like that).

Alternatively, we can express things in the way that Beth uses in Atlantis
with
\[ Z_i (w) = \frac{g_i M^{\ast}_i (w)}{g_i / c_i + \sum_j a_{i j} e_{i j} (w)}
\]
where $Z_i (w)$ reflects the aggregate clearance rate of a predator of type
$i$ if we take $c_i$ to be the ``clearance rate'' which incorporates the
volume it sweeps and a proportion of prey captured and we take $g_i$ to be the
predator's growth rate.

So $\int_0^{\infty} Z_i (w) e_{i j} (w) \Delta t d w$ is the amount of prey of
type $j$ consumed by the predators of type $i$ over the interval $\Delta t$.

\

It should be pointed out that the number of types is fairly small compared to
the number of agents, and this shouldn't be too onerous a calculation (at
least compared to playing it all out individually).

\section{Apportioning mortality}

Mortality can be calculated either by apportioning it to each agent according
to the proportion of the global population it represents (and within it,
apportioning the mortality to ages in an analogous fashion), or we can
apportion mortality to each age in each agent according to how much of the
population it represents.

For the agent-by-agent update we have
\[ \delta m_a (w) = \Omega^{\ast}_{T (a)}  \frac{m_a (w)}{M^{\ast}_{T (a)}
   (w)} \]
and for the age-by-age update we have
\[ \delta m_a (w) = \omega^{\ast}_{T (a)} (w)  \frac{m_a (w)}{M^{\ast}_{T (a)}
   (w)} . \]
The new distribution
\[ n_a (w) = m_a (w) - \delta m_a (w) . \]
In these steps, places where there are no members of size $w$ should be dealt
with carefully in the division, and at all points $M^{\ast}_{T (a)} (w)
\geqslant m_a (w)$.

\end{document}
